<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Unilux Socket Test Client</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .container {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .status {
                padding: 10px;
                margin: 10px 0;
                border-radius: 4px;
                font-weight: bold;
            }
            .connected {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .disconnected {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .message-area {
                height: 300px;
                border: 1px solid #ddd;
                padding: 10px;
                overflow-y: auto;
                background-color: #fafafa;
                margin: 10px 0;
            }
            .input-group {
                margin: 10px 0;
            }
            .input-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
            }
            .input-group input,
            .input-group button {
                padding: 8px;
                margin: 2px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }
            .input-group button {
                background-color: #007bff;
                color: white;
                cursor: pointer;
            }
            .input-group button:hover {
                background-color: #0056b3;
            }
            .message {
                margin: 5px 0;
                padding: 5px;
                border-left: 3px solid #007bff;
                background-color: #e9f4ff;
            }
            .room-message {
                border-left-color: #28a745;
                background-color: #e9f7ef;
            }
            .system-message {
                border-left-color: #ffc107;
                background-color: #fff8e1;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸš€ Unilux Socket Test Client</h1>

            <div id="status" class="status disconnected">ì—°ê²° ì•ˆë¨</div>

            <div class="input-group">
                <label>ì„œë²„ URL:</label>
                <input type="text" id="serverUrl" value="http://localhost:3000" style="width: 300px" />
                <button onclick="connect()">ì—°ê²°</button>
                <button onclick="disconnect()">ì—°ê²° í•´ì œ</button>
            </div>

            <div class="message-area" id="messages"></div>

            <div class="input-group">
                <label>ì „ì²´ ë©”ì‹œì§€:</label>
                <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="width: 300px" />
                <button onclick="sendMessage()">ì „ì†¡</button>
            </div>

            <div class="input-group">
                <label>ë£¸ ê´€ë¦¬:</label>
                <input type="text" id="roomInput" placeholder="ë£¸ ì´ë¦„" style="width: 150px" />
                <button onclick="joinRoom()">ë£¸ ì°¸ê°€</button>
                <button onclick="leaveRoom()">ë£¸ ë‚˜ê°€ê¸°</button>
            </div>

            <div class="input-group">
                <label>ë£¸ ë©”ì‹œì§€:</label>
                <input type="text" id="roomMessageInput" placeholder="ë£¸ ë©”ì‹œì§€" style="width: 200px" />
                <button onclick="sendRoomMessage()">ë£¸ì— ì „ì†¡</button>
            </div>

            <div class="input-group">
                <button onclick="clearMessages()">ë©”ì‹œì§€ ì§€ìš°ê¸°</button>
            </div>
        </div>

        <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
        <script>
            let socket = null;
            let currentRoom = null;

            function addMessage(message, type = 'normal') {
                const messagesDiv = document.getElementById('messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${
                    type === 'room' ? 'room-message' : type === 'system' ? 'system-message' : ''
                }`;

                const timestamp = new Date().toLocaleTimeString();
                messageDiv.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;

                messagesDiv.appendChild(messageDiv);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }

            function updateStatus(connected, message = '') {
                const statusDiv = document.getElementById('status');
                if (connected) {
                    statusDiv.className = 'status connected';
                    statusDiv.textContent = `ì—°ê²°ë¨ ${message}`;
                } else {
                    statusDiv.className = 'status disconnected';
                    statusDiv.textContent = `ì—°ê²° ì•ˆë¨ ${message}`;
                }
            }

            function connect() {
                const serverUrl = document.getElementById('serverUrl').value;

                if (socket) {
                    socket.disconnect();
                }

                socket = io(serverUrl);

                socket.on('connect', () => {
                    updateStatus(true, `(${socket.id})`);
                    addMessage('ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!', 'system');
                });

                socket.on('disconnect', (reason) => {
                    updateStatus(false, `(${reason})`);
                    addMessage(`ì—°ê²°ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤: ${reason}`, 'system');
                });

                socket.on('connected', (data) => {
                    addMessage(`ì„œë²„ ì‘ë‹µ: ${data.message}`, 'system');
                });

                socket.on('message', (data) => {
                    addMessage(`ğŸ’¬ ${data.socketId}: ${JSON.stringify(data)}`);
                });

                socket.on('user-joined', (data) => {
                    addMessage(`ğŸ‘‹ ${data.socketId}ë‹˜ì´ ë£¸ '${data.room}'ì— ì°¸ê°€í–ˆìŠµë‹ˆë‹¤.`, 'system');
                });

                socket.on('user-left', (data) => {
                    addMessage(`ğŸ‘‹ ${data.socketId}ë‹˜ì´ ë£¸ '${data.room}'ì—ì„œ ë‚˜ê°”ìŠµë‹ˆë‹¤.`, 'system');
                });

                socket.on('room-message', (data) => {
                    addMessage(`ğŸ  [${data.room}] ${data.socketId}: ${data.message}`, 'room');
                });

                socket.on('error', (error) => {
                    addMessage(`âŒ ì—ëŸ¬: ${error}`, 'system');
                });
            }

            function disconnect() {
                if (socket) {
                    socket.disconnect();
                    socket = null;
                }
            }

            function sendMessage() {
                const messageInput = document.getElementById('messageInput');
                const message = messageInput.value.trim();

                if (message && socket) {
                    socket.emit('message', {
                        text: message,
                        user: 'test-client',
                    });
                    messageInput.value = '';
                }
            }

            function joinRoom() {
                const roomInput = document.getElementById('roomInput');
                const room = roomInput.value.trim();

                if (room && socket) {
                    socket.emit('join-room', room);
                    currentRoom = room;
                    addMessage(`ë£¸ '${room}'ì— ì°¸ê°€ ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.`, 'system');
                }
            }

            function leaveRoom() {
                const roomInput = document.getElementById('roomInput');
                const room = roomInput.value.trim() || currentRoom;

                if (room && socket) {
                    socket.emit('leave-room', room);
                    if (currentRoom === room) {
                        currentRoom = null;
                    }
                    addMessage(`ë£¸ '${room}'ì—ì„œ ë‚˜ê°€ê¸° ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.`, 'system');
                }
            }

            function sendRoomMessage() {
                const roomMessageInput = document.getElementById('roomMessageInput');
                const roomInput = document.getElementById('roomInput');
                const message = roomMessageInput.value.trim();
                const room = roomInput.value.trim() || currentRoom;

                if (message && room && socket) {
                    socket.emit('room-message', {
                        room: room,
                        message: message,
                    });
                    roomMessageInput.value = '';
                }
            }

            function clearMessages() {
                document.getElementById('messages').innerHTML = '';
            }

            // Enter í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
            document.getElementById('messageInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            document.getElementById('roomMessageInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    sendRoomMessage();
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì—°ê²°
            window.onload = function () {
                addMessage('í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'system');
            };
        </script>
    </body>
</html>
